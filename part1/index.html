<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Login</title>
    <script src="https://unpkg.com/vue@3"></script>
    <link rel="stylesheet" href="/style.css" />
  </head>

  <body>
    <button
      type="button"
      id="themeToggle"
      class="secondary-btn"
      style="float: right; margin: 1em"
    >
      🌙
    </button>

    <div id="app">
      <h2>Login</h2>

      <form @submit.prevent="handleLogin">
        <label
          >Email:
          <input type="email" v-model="email" required />
        </label>
        <label
          >Password:
          <input type="password" v-model="password" required />
        </label>
        <button type="submit">Login</button>
      </form>

      <p v-if="errorMessage" class="error-message">{{ errorMessage }}</p>

      <p>Don't have an account?</p>
      <button type="button" class="secondary-btn" @click="goToRegister">
        Create Account
      </button>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            email: '',
            password: '',
            errorMessage: ''
          };
        },
        methods: {
          async handleLogin() {
            if (!this.email || !this.password) {
              this.errorMessage = 'Please enter both email and password.';
              return;
            }
            const { status } = await fetch('/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                email: this.email,
                password: this.password
              })
            });
            if (status === 200) {
              window.location.href = '/user/home';
              return;
            } else {
              this.errorMessage = 'Invalid email or password.';
              return;
            }
          },
          goToRegister() {
            window.location.href = '/register-page';
          }
        },
        mounted() {
          const isDark = localStorage.getItem('theme') === 'dark';
          document.body.classList.toggle('dark-mode', isDark);
          const toggleBtn = document.getElementById('themeToggle');
          toggleBtn.innerText = isDark ? '☀️ Light' : '🌙 Dark';
          toggleBtn.addEventListener('click', () => {
            const isNowDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isNowDark ? 'dark' : 'light');
            toggleBtn.innerText = isNowDark ? '☀️ Light' : '🌙 Dark';
          });
        }
      }).mount('#app');
    </script>
  </body>
</html>